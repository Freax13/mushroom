.section .pagetables, "aw"

.set PTE_PRESENT, 1 << 0
.set PTE_WRITABLE, 1 << 1
.set PTE_HUGE, 1 << 7
.set PTE_NO_EXECUTE, 1 << 63

.align 4096
pml4:
.fill 256, 8, 0
.quad pdp_256 + PTE_PRESENT + PTE_WRITABLE
.quad pdp_257 + PTE_PRESENT + PTE_WRITABLE + PTE_NO_EXECUTE
.quad pdp_258 + PTE_PRESENT + PTE_WRITABLE + PTE_NO_EXECUTE
.fill 93, 8, 0
.quad pdp_352 + PTE_PRESENT + PTE_WRITABLE + PTE_NO_EXECUTE
.fill 157, 8, 0
.quad pml4 + PTE_PRESENT + PTE_WRITABLE + PTE_NO_EXECUTE
.quad 0

.align 4096
pdp_256:
.quad pd_256_0 + PTE_PRESENT + PTE_WRITABLE
.quad 0x80040000000 + PTE_PRESENT + PTE_WRITABLE + PTE_NO_EXECUTE + PTE_HUGE # profiler_buffer
.fill 510, 8, 0

.align 4096
pd_256_0:
# reset_vector
.quad 0x10040000000 + PTE_PRESENT + PTE_HUGE
# text
.quad 0x10040200000 + PTE_PRESENT + PTE_HUGE
.quad 0x10040400000 + PTE_PRESENT + PTE_HUGE
.quad 0x10040600000 + PTE_PRESENT + PTE_HUGE
.quad 0x10040800000 + PTE_PRESENT + PTE_HUGE
.quad 0x10040a00000 + PTE_PRESENT + PTE_HUGE
.quad 0x10040c00000 + PTE_PRESENT + PTE_HUGE
.quad 0x10040e00000 + PTE_PRESENT + PTE_HUGE
# rodata
.quad 0x10080000000 + PTE_PRESENT + PTE_NO_EXECUTE + PTE_HUGE
.quad 0x10080200000 + PTE_PRESENT + PTE_NO_EXECUTE + PTE_HUGE
.quad 0x10080400000 + PTE_PRESENT + PTE_NO_EXECUTE + PTE_HUGE
.quad 0x10080600000 + PTE_PRESENT + PTE_NO_EXECUTE + PTE_HUGE
.quad 0x10080800000 + PTE_PRESENT + PTE_NO_EXECUTE + PTE_HUGE
.quad 0x10080a00000 + PTE_PRESENT + PTE_NO_EXECUTE + PTE_HUGE
.quad 0x10080c00000 + PTE_PRESENT + PTE_NO_EXECUTE + PTE_HUGE
.quad 0x10080e00000 + PTE_PRESENT + PTE_NO_EXECUTE + PTE_HUGE
# data
.quad 0x100c0000000 + PTE_PRESENT + PTE_WRITABLE + PTE_NO_EXECUTE + PTE_HUGE
.quad 0x100c0200000 + PTE_PRESENT + PTE_WRITABLE + PTE_NO_EXECUTE + PTE_HUGE
.quad 0x100c0400000 + PTE_PRESENT + PTE_WRITABLE + PTE_NO_EXECUTE + PTE_HUGE
.quad 0x100c0600000 + PTE_PRESENT + PTE_WRITABLE + PTE_NO_EXECUTE + PTE_HUGE
.quad 0x100c0800000 + PTE_PRESENT + PTE_WRITABLE + PTE_NO_EXECUTE + PTE_HUGE
.quad 0x100c0a00000 + PTE_PRESENT + PTE_WRITABLE + PTE_NO_EXECUTE + PTE_HUGE
.quad 0x100c0c00000 + PTE_PRESENT + PTE_WRITABLE + PTE_NO_EXECUTE + PTE_HUGE
.quad 0x100c0e00000 + PTE_PRESENT + PTE_WRITABLE + PTE_NO_EXECUTE + PTE_HUGE
# tdata
.quad 0x10100000000 + PTE_PRESENT + PTE_NO_EXECUTE + PTE_HUGE
.quad 0x10100200000 + PTE_PRESENT + PTE_NO_EXECUTE + PTE_HUGE
.quad 0x10100400000 + PTE_PRESENT + PTE_NO_EXECUTE + PTE_HUGE
.quad 0x10100600000 + PTE_PRESENT + PTE_NO_EXECUTE + PTE_HUGE
.quad 0x10100800000 + PTE_PRESENT + PTE_NO_EXECUTE + PTE_HUGE
.quad 0x10100a00000 + PTE_PRESENT + PTE_NO_EXECUTE + PTE_HUGE
.quad 0x10100c00000 + PTE_PRESENT + PTE_NO_EXECUTE + PTE_HUGE
.quad 0x10100e00000 + PTE_PRESENT + PTE_NO_EXECUTE + PTE_HUGE
# stack
.quad 0x10140000000 + PTE_PRESENT + PTE_WRITABLE + PTE_NO_EXECUTE + PTE_HUGE
.quad 0x10140200000 + PTE_PRESENT + PTE_WRITABLE + PTE_NO_EXECUTE + PTE_HUGE
.quad 0x10140400000 + PTE_PRESENT + PTE_WRITABLE + PTE_NO_EXECUTE + PTE_HUGE
.quad 0x10140600000 + PTE_PRESENT + PTE_WRITABLE + PTE_NO_EXECUTE + PTE_HUGE
.quad 0x10140800000 + PTE_PRESENT + PTE_WRITABLE + PTE_NO_EXECUTE + PTE_HUGE
.quad 0x10140a00000 + PTE_PRESENT + PTE_WRITABLE + PTE_NO_EXECUTE + PTE_HUGE
.quad 0x10140c00000 + PTE_PRESENT + PTE_WRITABLE + PTE_NO_EXECUTE + PTE_HUGE
.quad 0x10140e00000 + PTE_PRESENT + PTE_WRITABLE + PTE_NO_EXECUTE + PTE_HUGE
# profiler_control
.quad 0x80000000000 + PTE_PRESENT + PTE_WRITABLE + PTE_NO_EXECUTE + PTE_HUGE
.quad 0x80000200000 + PTE_PRESENT + PTE_WRITABLE + PTE_NO_EXECUTE + PTE_HUGE
.quad 0x80000400000 + PTE_PRESENT + PTE_WRITABLE + PTE_NO_EXECUTE + PTE_HUGE
.quad 0x80000600000 + PTE_PRESENT + PTE_WRITABLE + PTE_NO_EXECUTE + PTE_HUGE
.quad 0x80000800000 + PTE_PRESENT + PTE_WRITABLE + PTE_NO_EXECUTE + PTE_HUGE
.quad 0x80000a00000 + PTE_PRESENT + PTE_WRITABLE + PTE_NO_EXECUTE + PTE_HUGE
.quad 0x80000c00000 + PTE_PRESENT + PTE_WRITABLE + PTE_NO_EXECUTE + PTE_HUGE
.quad 0x80000e00000 + PTE_PRESENT + PTE_WRITABLE + PTE_NO_EXECUTE + PTE_HUGE
.fill 464, 8, 0

.align 4096
pdp_352:
.quad pd_352_0 + PTE_PRESENT + PTE_WRITABLE + PTE_NO_EXECUTE
.fill 511, 8, 0

# KASAN shadow mapping
.align 4096
pd_352_0:
.quad 0x18000000000 + PTE_PRESENT + PTE_WRITABLE + PTE_NO_EXECUTE + PTE_HUGE # reset_vector + text
.quad 0x18000200000 + PTE_PRESENT + PTE_WRITABLE + PTE_NO_EXECUTE + PTE_HUGE # rodata
.quad 0x18000400000 + PTE_PRESENT + PTE_WRITABLE + PTE_NO_EXECUTE + PTE_HUGE # data
.quad 0x18000600000 + PTE_PRESENT + PTE_WRITABLE + PTE_NO_EXECUTE + PTE_HUGE # tdata
.quad 0x18000800000 + PTE_PRESENT + PTE_WRITABLE + PTE_NO_EXECUTE + PTE_HUGE # stack
.quad 0 # profiler_control
.fill 506, 8, 0

# Dynamic physical memory mapping
.align 4096
pdp_257:
.set i, 0
.rept 512
.quad 0x20000000000 + i * 0x40000000 + PTE_PRESENT + PTE_WRITABLE + PTE_NO_EXECUTE + PTE_HUGE
.set i, i + 1
.endr

.align 4096
pdp_258:
.rept 512
.quad 0x20000000000 + i * 0x40000000 + PTE_PRESENT + PTE_WRITABLE + PTE_NO_EXECUTE + PTE_HUGE
.set i, i + 1
.endr

.section .stack, "aw"
stack:
.fill 4 * 4096, 1, 0
stack_end:
